!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WaveSurfer",[],t):"object"==typeof exports?exports.WaveSurfer=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.timeline=t())}(self,function(){return(()=>{"use strict";var i={"./src/plugin/timeline/index.js":(e,t)=>{function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function i(e,t){var r=this;if(!function(e){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this),s.call(this),this.container="string"==typeof e.container?document.querySelector(e.container):e.container,!this.container)throw new Error("No container for wavesurfer timeline");this.wavesurfer=t,this.util=t.util,this.params=Object.assign({},{height:20,notchPercentHeight:90,labelPadding:5,unlabeledNotchColor:"#c0c0c0",primaryColor:"#000",secondaryColor:"#c0c0c0",primaryFontColor:"#000",secondaryFontColor:"#000",fontFamily:"Arial",fontSize:10,duration:null,zoomDebounce:!1,formatTimeCallback:this.defaultFormatTimeCallback,timeInterval:this.defaultTimeInterval,primaryLabelInterval:this.defaultPrimaryLabelInterval,secondaryLabelInterval:this.defaultSecondaryLabelInterval,offset:0},e),this.canvases=[],this.wrapper=null,this.drawer=null,this.pixelRatio=null,this.maxCanvasWidth=null,this.maxCanvasElementWidth=null,this._onZoom=this.params.zoomDebounce?this.wavesurfer.util.debounce(function(){return r.render()},this.params.zoomDebounce):function(){return r.render()}}var e,t,r;return e=i,r=[{key:"create",value:function(e){return{name:"timeline",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,instance:i}}}],(t=[{key:"init",value:function(){this.wavesurfer.isReady?this._onReady():this.wavesurfer.once("ready",this._onReady)}},{key:"destroy",value:function(){this.unAll(),this.wavesurfer.un("redraw",this._onRedraw),this.wavesurfer.un("zoom",this._onZoom),this.wavesurfer.un("ready",this._onReady),this.wavesurfer.drawer.wrapper.removeEventListener("scroll",this._onScroll),this.wrapper&&this.wrapper.parentNode&&(this.wrapper.removeEventListener("click",this._onWrapperClick),this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)}},{key:"createWrapper",value:function(){var e=this.wavesurfer.params;this.container.innerHTML="",this.wrapper=this.container.appendChild(document.createElement("timeline")),this.util.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:"".concat(this.params.height,"px")}),(e.fillParent||e.scrollParent)&&this.util.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"}),this.wrapper.addEventListener("click",this._onWrapperClick)}},{key:"render",value:function(){this.wrapper||this.createWrapper(),this.updateCanvases(),this.updateCanvasesPositioning(),this.renderCanvases()}},{key:"addCanvas",value:function(){var e=this.wrapper.appendChild(document.createElement("canvas"));this.canvases.push(e),this.util.style(e,{position:"absolute",zIndex:4})}},{key:"removeCanvas",value:function(){var e=this.canvases.pop();e.parentElement.removeChild(e)}},{key:"updateCanvases",value:function(){for(var e=Math.round(this.drawer.wrapper.scrollWidth),t=Math.ceil(e/this.maxCanvasElementWidth);this.canvases.length<t;)this.addCanvas();for(;this.canvases.length>t;)this.removeCanvas()}},{key:"updateCanvasesPositioning",value:function(){var i=this,a=this.canvases.length;this.canvases.forEach(function(e,t){var r=t===a-1?i.drawer.wrapper.scrollWidth-i.maxCanvasElementWidth*(a-1):i.maxCanvasElementWidth;e.width=r*i.pixelRatio,e.height=(i.params.height+1)*i.pixelRatio,i.util.style(e,{width:"".concat(r,"px"),height:"".concat(i.params.height,"px"),left:"".concat(t*i.maxCanvasElementWidth,"px")})})}},{key:"renderCanvases",value:function(){var i=this,e=this.params.duration||this.wavesurfer.backend.getDuration();if(!(e<=0)){for(var t=this.wavesurfer.params,r=this.params.fontSize*t.pixelRatio,a=parseInt(e,10)+1,t=t.fillParent&&!t.scrollParent?this.drawer.getWidth():this.drawer.wrapper.scrollWidth*t.pixelRatio,s=this.params.height*this.pixelRatio,n=this.params.height*(this.params.notchPercentHeight/100)*this.pixelRatio,o=t/e,l=this.params.formatTimeCallback,e=function(e){return"function"==typeof e?e(o):e},h=e(this.params.timeInterval),u=e(this.params.primaryLabelInterval),c=e(this.params.secondaryLabelInterval),p=o*this.params.offset,d=0,f=[],m=0;m<a/h;m++)f.push([m,d,p]),d+=h,p+=o*h;e=function(t){f.forEach(function(e){t(e[0],e[1],e[2])})};this.setFillStyles(this.params.primaryColor),this.setFonts("".concat(r,"px ").concat(this.params.fontFamily)),this.setFillStyles(this.params.primaryFontColor),e(function(e,t,r){e%u==0&&(i.fillRect(r,0,1,s),i.fillText(l(t,o),r+i.params.labelPadding*i.pixelRatio,s))}),this.setFillStyles(this.params.secondaryColor),this.setFonts("".concat(r,"px ").concat(this.params.fontFamily)),this.setFillStyles(this.params.secondaryFontColor),e(function(e,t,r){e%c==0&&(i.fillRect(r,0,1,s),i.fillText(l(t,o),r+i.params.labelPadding*i.pixelRatio,s))}),this.setFillStyles(this.params.unlabeledNotchColor),e(function(e,t,r){e%c!=0&&e%u!=0&&i.fillRect(r,0,1,n)})}}},{key:"setFillStyles",value:function(t){this.canvases.forEach(function(e){e=e.getContext("2d");e&&(e.fillStyle=t)})}},{key:"setFonts",value:function(t){this.canvases.forEach(function(e){e=e.getContext("2d");e&&(e.font=t)})}},{key:"fillRect",value:function(i,a,s,n){var o=this;this.canvases.forEach(function(e,t){var r=t*o.maxCanvasWidth,t={x1:Math.max(i,t*o.maxCanvasWidth),y1:a,x2:Math.min(i+s,t*o.maxCanvasWidth+e.width),y2:a+n};t.x1<t.x2&&((e=e.getContext("2d"))&&e.fillRect(t.x1-r,t.y1,t.x2-t.x1,t.y2-t.y1))})}},{key:"fillText",value:function(r,i,a){var s,n=0;this.canvases.forEach(function(e){var t=e.getContext("2d");t&&(e=t.canvas.width,i+s<n||(i<n+e&&t&&(s=t.measureText(r).width,t.fillText(r,i-n,a)),n+=e))})}},{key:"defaultFormatTimeCallback",value:function(e,t){if(1<e/60){var r=parseInt(e/60,10);return e=(e=parseInt(e%60,10))<10?"0"+e:e,"".concat(r,":").concat(e)}return Math.round(1e3*e)/1e3}},{key:"defaultTimeInterval",value:function(e){return 25<=e?1:25<=5*e?5:25<=15*e?15:60*Math.ceil(.5/e)}},{key:"defaultPrimaryLabelInterval",value:function(e){return 25<=e?10:25<=5*e?6:4}},{key:"defaultSecondaryLabelInterval",value:function(e){return 25<=e?5:2}}])&&a(e.prototype,t),r&&a(e,r),i}();t.default=r;var s=function(){var t=this;this._onScroll=function(){t.wrapper&&t.drawer.wrapper&&(t.wrapper.scrollLeft=t.drawer.wrapper.scrollLeft)},this._onRedraw=function(){return t.render()},this._onReady=function(){var e=t.wavesurfer;t.drawer=e.drawer,t.pixelRatio=e.drawer.params.pixelRatio,t.maxCanvasWidth=e.drawer.maxCanvasWidth||e.drawer.width,t.maxCanvasElementWidth=e.drawer.maxCanvasElementWidth||Math.round(t.maxCanvasWidth/t.pixelRatio),e.drawer.wrapper.addEventListener("scroll",t._onScroll),e.on("redraw",t._onRedraw),e.on("zoom",t._onZoom),t.render()},this._onWrapperClick=function(e){e.preventDefault();e="offsetX"in e?e.offsetX:e.layerX;t.fireEvent("click",e/t.wrapper.scrollWidth||0)}};e.exports=t.default}},a={};return function e(t){var r=a[t];if(void 0!==r)return r.exports;r=a[t]={exports:{}};return i[t](r,r.exports,e),r.exports}("./src/plugin/timeline/index.js")})()}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WaveSurfer",[],t):"object"==typeof exports?exports.WaveSurfer=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.cursor=t())}(self,function(){return(()=>{"use strict";var i={"./src/plugin/cursor/index.js":(e,t)=>{function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function r(e,t){var s=this;!function(e){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),this.defaultParams={hideOnBlur:!0,width:"1px",color:"black",opacity:"0.25",style:"solid",zIndex:4,customStyle:{},customShowTimeStyle:{},showTime:!1,followCursorY:!1,formatTimeCallback:null},this._onMousemove=function(e){var t=s.wavesurfer.container.getBoundingClientRect(),r=0,i=e.clientX-t.left,a=t.right<e.clientX+s.outerWidth(s.displayTime);s.params.showTime&&s.params.followCursorY&&(r=e.clientY-(t.top+t.height/2)),s.updateCursorPosition(i,r,a)},this._onMouseenter=function(){return s.showCursor()},this._onMouseleave=function(){return s.hideCursor()},this.wavesurfer=t,this.style=t.util.style,this.cursor=null,this.showTime=null,this.displayTime=null,this.params=Object.assign({},this.defaultParams,e)}var e,t,i;return e=r,i=[{key:"create",value:function(e){return{name:"cursor",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{},instance:r}}}],(t=[{key:"init",value:function(){this.wrapper=this.wavesurfer.container,this.cursor=this.wrapper.appendChild(this.style(document.createElement("cursor"),Object.assign({position:"absolute",zIndex:this.params.zIndex,left:0,top:0,bottom:0,width:"0",display:"flex",borderRightStyle:this.params.style,borderRightWidth:this.params.width,borderRightColor:this.params.color,opacity:this.params.opacity,pointerEvents:"none"},this.params.customStyle))),this.params.showTime&&(this.showTime=this.wrapper.appendChild(this.style(document.createElement("showTitle"),Object.assign({position:"absolute",zIndex:this.params.zIndex,left:0,top:0,bottom:0,width:"auto",display:"flex",opacity:this.params.opacity,pointerEvents:"none",height:"100%"},this.params.customStyle))),this.displayTime=this.showTime.appendChild(this.style(document.createElement("div"),Object.assign({display:"inline",pointerEvents:"none",margin:"auto",visibility:"hidden"},this.params.customShowTimeStyle))),this.displayTime.innerHTML=this.formatTime(0)),this.wrapper.addEventListener("mousemove",this._onMousemove),this.params.hideOnBlur&&(this.hideCursor(),this.wrapper.addEventListener("mouseenter",this._onMouseenter),this.wrapper.addEventListener("mouseleave",this._onMouseleave))}},{key:"destroy",value:function(){this.params.showTime&&this.cursor.parentNode.removeChild(this.showTime),this.cursor.parentNode.removeChild(this.cursor),this.wrapper.removeEventListener("mousemove",this._onMousemove),this.params.hideOnBlur&&(this.wrapper.removeEventListener("mouseenter",this._onMouseenter),this.wrapper.removeEventListener("mouseleave",this._onMouseleave))}},{key:"updateCursorPosition",value:function(e,t){var r,i,a,s=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this.style(this.cursor,{left:"".concat(e,"px")}),this.params.showTime&&(r=this.wavesurfer.getDuration(),i=this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio,a=this.wavesurfer.drawer.getScrollX(),a=r/this.wavesurfer.drawer.width*a,a=Math.max(0,e/i*r)+a,a=this.formatTime(a),s&&(e-=this.outerWidth(this.displayTime)),this.style(this.showTime,{left:"".concat(e,"px"),top:"".concat(t,"px")}),this.style(this.displayTime,{visibility:"visible"}),this.displayTime.innerHTML="".concat(a))}},{key:"showCursor",value:function(){this.style(this.cursor,{display:"flex"}),this.params.showTime&&this.style(this.showTime,{display:"flex"})}},{key:"hideCursor",value:function(){this.style(this.cursor,{display:"none"}),this.params.showTime&&this.style(this.showTime,{display:"none"})}},{key:"formatTime",value:function(e){return e=isNaN(e)?0:e,this.params.formatTimeCallback?this.params.formatTimeCallback(e):[e].map(function(e){return[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2),("00"+Math.floor(e%1*1e2)).slice(-2)].join(":")})}},{key:"outerWidth",value:function(e){if(!e)return 0;var t=e.offsetWidth,e=getComputedStyle(e);return t+=parseInt(e.marginLeft+e.marginRight)}}])&&a(e.prototype,t),i&&a(e,i),r}();t.default=r,e.exports=t.default}},a={};return function e(t){var r=a[t];if(void 0!==r)return r.exports;r=a[t]={exports:{}};return i[t](r,r.exports,e),r.exports}("./src/plugin/cursor/index.js")})()});